{"version":3,"sources":["functions/user.js","pages/Checkout.js"],"names":["userCart","cart","authtoken","a","axios","post","process","headers","getUserCart","get","emptyUserCart","delete","saveUserAddress","address","applyCoupon","coupon","createOrder","stripeResponse","createCashOrderForUser","COD","couponTrueOrFalse","couponApplied","getUserOrders","getWishList","addToWishList","productId","removeWishList","put","Checkout","history","useState","products","setProducts","total","setTotal","setAddress","addressSaved","setAddressSaved","setCoupon","totalAfterDiscount","setTotalAfterDiscount","discountError","setDiscountError","dispatch","useDispatch","useSelector","state","user","useEffect","token","then","res","console","log","JSON","stringify","data","cartTotal","saveAddressToDb","ok","toast","success","applyDiscountCoupon","type","payload","err","className","theme","value","onChange","onClick","length","e","target","disabled","map","p","i","product","title","color","count","price","window","localStorage","removeItem","push","error","catch"],"mappings":"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","file":"static/js/43.85137719.chunk.js","sourcesContent":["import axios from \"axios\";\r\n\r\nexport const userCart = async (cart, authtoken) =>\r\n    await axios.post(\r\n        `${process.env.REACT_APP_API}/user/cart`,\r\n        { cart },\r\n        {\r\n            headers: {\r\n                authtoken,\r\n            },\r\n        }\r\n    );\r\n\r\nexport const getUserCart = async (authtoken) =>\r\n    await axios.get(`${process.env.REACT_APP_API}/user/cart`, {\r\n        headers: {\r\n            authtoken,\r\n        },\r\n    });\r\n\r\nexport const emptyUserCart = async (authtoken) =>\r\n    await axios.delete(`${process.env.REACT_APP_API}/user/cart`, {\r\n        headers: {\r\n            authtoken,\r\n        },\r\n    });\r\n\r\nexport const saveUserAddress = async (authtoken, address) =>\r\n    await axios.post(\r\n        `${process.env.REACT_APP_API}/user/address`,\r\n        { address },\r\n        {\r\n            headers: {\r\n                authtoken,\r\n            },\r\n        }\r\n    );\r\n\r\nexport const applyCoupon = async (authtoken, coupon) =>\r\n    await axios.post(\r\n        `${process.env.REACT_APP_API}/user/cart/coupon`,\r\n        { coupon },\r\n        {\r\n            headers: {\r\n                authtoken,\r\n            },\r\n        }\r\n    );\r\n\r\nexport const createOrder = async (stripeResponse, authtoken) =>\r\n    await axios.post(\r\n        `${process.env.REACT_APP_API}/user/order`,\r\n        { stripeResponse },\r\n        {\r\n            headers: {\r\n                authtoken,\r\n            },\r\n        }\r\n    );\r\nexport const createCashOrderForUser = async (authtoken, COD, couponTrueOrFalse) =>\r\n    await axios.post(\r\n        `${process.env.REACT_APP_API}/user/cash-order`,\r\n        { COD, couponApplied: couponTrueOrFalse },\r\n        {\r\n            headers: {\r\n                authtoken,\r\n            },\r\n        }\r\n    );\r\n\r\nexport const getUserOrders = async (authtoken) =>\r\n    await axios.get(\r\n        `${process.env.REACT_APP_API}/user/orders`,\r\n        {\r\n            headers: {\r\n                authtoken,\r\n            },\r\n        }\r\n    );\r\n\r\nexport const getWishList = async (authtoken) =>\r\n    await axios.get(\r\n        `${process.env.REACT_APP_API}/user/wishlist`,\r\n        {\r\n            headers: {\r\n                authtoken,\r\n            },\r\n        }\r\n    );\r\nexport const addToWishList = async (productId, authtoken) =>\r\n    await axios.post(\r\n        `${process.env.REACT_APP_API}/user/wishlist`,\r\n        { productId },\r\n        {\r\n            headers: {\r\n                authtoken,\r\n            },\r\n        }\r\n    );\r\n\r\nexport const removeWishList = async (productId, authtoken) =>\r\n    await axios.put(\r\n        `${process.env.REACT_APP_API}/user/wishlist/${productId}`,\r\n        {},\r\n        {\r\n            headers: {\r\n                authtoken,\r\n            },\r\n        }\r\n    );","import React, { useEffect, useState } from \"react\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { toast } from \"react-toastify\";\r\nimport {\r\n    getUserCart,\r\n    emptyUserCart,\r\n    saveUserAddress,\r\n    applyCoupon,\r\n    createCashOrderForUser,\r\n} from \"../functions/user\";\r\nimport ReactQuill from \"react-quill\";\r\nimport \"react-quill/dist/quill.snow.css\";\r\n\r\nconst Checkout = ({ history }) => {\r\n    const [products, setProducts] = useState([]);\r\n    const [total, setTotal] = useState(0);\r\n    const [address, setAddress] = useState(\"\");\r\n    const [addressSaved, setAddressSaved] = useState(false);\r\n    const [coupon, setCoupon] = useState(\"\");\r\n    // discount price\r\n    const [totalAfterDiscount, setTotalAfterDiscount] = useState(0);\r\n    const [discountError, setDiscountError] = useState(\"\");\r\n\r\n    const dispatch = useDispatch();\r\n    const { user, COD } = useSelector((state) => ({ ...state }));\r\n    const couponTrueOrFalse = useSelector((state) => state.coupon);\r\n\r\n    useEffect(() => {\r\n        getUserCart(user.token).then((res) => {\r\n            console.log(\"user cart res\", JSON.stringify(res.data, null, 4));\r\n            setProducts(res.data.products);\r\n            setTotal(res.data.cartTotal);\r\n        });\r\n    }, []);\r\n\r\n    const emptyCart = () => {\r\n        // remove from local storage\r\n        if (typeof window !== \"undefined\") {\r\n            localStorage.removeItem(\"cart\");\r\n        }\r\n        // remove from redux\r\n        dispatch({\r\n            type: \"ADD_TO_CART\",\r\n            payload: [],\r\n        });\r\n        // remove from backend\r\n        emptyUserCart(user.token).then((res) => {\r\n            setProducts([]);\r\n            setTotal(0);\r\n            setTotalAfterDiscount(0);\r\n            setCoupon(\"\");\r\n            toast.success(\"Cart is emapty. Contniue shopping.\");\r\n        });\r\n    };\r\n\r\n    const saveAddressToDb = () => {\r\n        // console.log(address);\r\n        saveUserAddress(user.token, address).then((res) => {\r\n            if (res.data.ok) {\r\n                setAddressSaved(true);\r\n                toast.success(\"Address saved\");\r\n            }\r\n        });\r\n    };\r\n\r\n    const applyDiscountCoupon = () => {\r\n        console.log(\"send coupon to backend\", coupon);\r\n        applyCoupon(user.token, coupon).then((res) => {\r\n            console.log(\"RES ON COUPON APPLIED\", res.data);\r\n            if (res.data) {\r\n                setTotalAfterDiscount(res.data);\r\n                dispatch({\r\n                    type: 'COUPON_APPLIED',\r\n                    payload: true\r\n                })\r\n                // update redux coupon applied\r\n            }\r\n            // error\r\n            if (res.data.err) {\r\n                setDiscountError(res.data.err);\r\n                // update redux coupon applied\r\n            }\r\n        });\r\n    };\r\n\r\n    const showAddress = () => (\r\n        <>\r\n            <ReactQuill theme=\"snow\" value={address} onChange={setAddress} />\r\n            <button className=\"btn btn-primary mt-2\" onClick={saveAddressToDb}>\r\n                Save\r\n      </button>\r\n        </>\r\n    );\r\n\r\n    const showProductSummary = () =>\r\n        products.map((p, i) => (\r\n            <div key={i}>\r\n                <p>\r\n                    {p.product.title} ({p.color}) x {p.count} ={\" \"}\r\n                    {p.product.price * p.count}\r\n                </p>\r\n            </div>\r\n        ));\r\n\r\n    const showApplyCoupon = () => (\r\n        <>\r\n            <input\r\n                onChange={(e) => {\r\n                    setCoupon(e.target.value);\r\n                    setDiscountError(\"\");\r\n                }}\r\n                value={coupon}\r\n                type=\"text\"\r\n                className=\"form-control\"\r\n                disabled={!products.length}\r\n            />\r\n            <button\r\n                disabled={!products.length}\r\n                onClick={applyDiscountCoupon}\r\n                className=\"btn btn-primary mt-2\">\r\n\r\n                Apply\r\n      </button>\r\n        </>\r\n    );\r\n    const createCashOrder = () => {\r\n        createCashOrderForUser(user.token, COD, couponTrueOrFalse)\r\n            .then(res => {\r\n                console.log('USER CASH ORDER CREATED:', res.data)\r\n\r\n\r\n                if (res.data.ok) {\r\n                    if (typeof window !== 'undefined') {\r\n                        localStorage.removeItem('cart')\r\n                    }\r\n                    dispatch({\r\n                        type: 'ADD_TO_CART',\r\n                        payload: []\r\n                    })\r\n                    dispatch({\r\n                        type: 'COD',\r\n                        payload: false\r\n                    })\r\n                    dispatch({\r\n                        type: 'COUPON_APPLIED',\r\n                        payload: false\r\n                    })\r\n                    emptyUserCart(user.token)\r\n                    toast.success('Order Placed')\r\n                    history.push('/user/history')\r\n                }\r\n                else {\r\n                    toast.error('Cash On Order placed failed')\r\n                }\r\n\r\n\r\n\r\n\r\n\r\n\r\n            })\r\n            .catch(err => {\r\n                console.log(err)\r\n            })\r\n    }\r\n\r\n    return (\r\n        <div className=\"row\">\r\n            <div className=\"col-md-6\">\r\n                <h4>Delivery Address</h4>\r\n                <br />\r\n                <br />\r\n                {showAddress()}\r\n                <hr />\r\n                <h4>Got Coupon?</h4>\r\n                <br />\r\n                {products.length && showApplyCoupon()}\r\n                <br />\r\n                {discountError && <p className=\"bg-danger p-2\">{discountError}</p>}\r\n            </div>\r\n\r\n            <div className=\"col-md-6\">\r\n                <h4>Order Summary</h4>\r\n                <hr />\r\n                <p>Products {products.length}</p>\r\n                <hr />\r\n                {showProductSummary()}\r\n                <hr />\r\n                <p>Cart Total: {total}</p>\r\n\r\n                {totalAfterDiscount > 0 && (\r\n                    <p className=\"bg-success p-2\">\r\n                        Discount Applied: Total Payable: ${totalAfterDiscount}\r\n                    </p>\r\n                )}\r\n\r\n                <div className=\"row\">\r\n                    <div className=\"col-md-6\">\r\n                        {COD ? (<button\r\n                            onClick={createCashOrder}\r\n                            className=\"btn btn-primary\"\r\n                            disabled={!addressSaved || !products.length}\r\n                        >\r\n                            Checkout\r\n                        </button>) :\r\n                            (<button\r\n                                onClick={() => history.push('/payment')}\r\n                                className=\"btn btn-primary\"\r\n                                disabled={!addressSaved || !products.length}\r\n                            >\r\n                                Place Order\r\n                            </button>)\r\n                        }\r\n\r\n                    </div>\r\n\r\n                    <div className=\"col-md-6\">\r\n                        <button\r\n                            disabled={!products.length}\r\n                            onClick={emptyCart}\r\n                            className=\"btn btn-primary\"\r\n                        >\r\n                            Empty Cart\r\n            </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default Checkout;\r\n"],"sourceRoot":""}